■Dockerコンテナ上のRedMineへのプラグイン追加についての考察



・sameersbn/redmineの最新はVersion5系であり、4系で動作していたプラグインは動作しない可能性が高い
→4系のコンテナを使用する

sudo docker run \
--restart=always \
--name=redmine \
-d \
-e 'TZ=Asia/Tokyo' \
-e 'SMTP_ENABLED=true' \
-e 'SMTP_METHOD=smtp' \
-e 'SMTP_DOMAIN=smtp.gmail.com' \
-e 'SMTP_HOST=smtp.gmail.com' \
-e 'SMTP_PORT=587' \
-e 'SMTP_USER=redmine.souken@gmail.com' \
-e 'SMTP_PASS=Souken8246' \
-e 'SMTP_STARTTLS=true' \
-e 'SMTP_AUTHENTICATION=:login' \
-p 8001:80 \
--link redmine-mysql:mysql \
--link openldap:ldap \
-v /srv/docker/redmine/home/redmine/data:/home/redmine/data \
-v /srv/docker/redmine/home/redmine/redmine/plugins:/home/redmine/redmine/plugins \
sameersbn/redmine:4.2.7



・redmine上で、railsのスクリプトを実行し、プラグインについての各ひな形を出力する
・プラグイン自体のひな形出力
ruby bin/rails generate redmine_plugin [プラグイン]
・モデルの出力
ruby bin/rails generate redmine_plugin_model [プラグイン] [モデル] [メンバ]:[型]...
・モデルをmigrate
bundle exec rake redmine:plugins:migrate
・コントローラの出力
ruby bin/rails generate redmine_plugin_controller [プラグイン] [コントローラ] [メソッド]...
・/home/redmine/redmine/pluginsに出力されるが、再起動のたび/home/redmine/data/pluginsから復元されている
・出力したひな形を、/home/redmine/data/pluginsにコピーしてこれを編集する
・実際のスクリプト
ruby bin/rails generate redmine_plugin daily_report
ruby bin/rails generate redmine_plugin_model daily_report daily_report user_id:integer yyyy:string mm:string dd:string bo_time:string eo_time:string issue_id:integer activity_id:integer comments:string
bundle exec rake redmine:plugins:migrate
ruby bin/rails generate redmine_plugin_controller daily_report daily_report index regist



・railsのIDEとしては、現状、Aptanaがベター
・pleiadesにより日本語化すると起動しなくなる



○機能実装
■ログイン情報取得
■ByName担当分、グループ担当分の未完了チケットリスト取得
■日付選択
■時刻表描画処理
■時刻表上の時間帯変更機能
■作業報告新規追加ダイアログ初期表示
■作業報告内容の時刻表反映処理
■作業報告内容の登録処理
■既登録作業報告の照会処理
■既登録作業報告の削除処理
■既登録作業報告の更新処理
■作業日毎の作業報告照会処理
■作業報告内容のRedMine作業時間連携処理
■作業時間の合計処理
